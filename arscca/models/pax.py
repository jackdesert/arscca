import pdb
from decimal import Decimal
from arscca.models.shared import Shared
from types import MappingProxyType

class Pax:

    FACTORS_2009 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.843,
                         ASP  = 0.866,
                         BM   = 0.944,
                         BP   = 0.868,
                         BS   = 0.835,
                         BSP  = 0.859,
                         CM   = 0.907,
                         CP   = 0.864,
                         CS   = 0.837,
                         CSP  = 0.862,
                         DM   = 0.900,
                         DP   = 0.865,
                         DS   = 0.819,
                         DSP  = 0.845,
                         EM   = 0.894,
                         EP   = 0.861,
                         ES   = 0.823,
                         ESP  = 0.846,
                         F125 = 0.957,
                         FJA  = 0.860,
                         FJB  = 0.832,
                         FJC  = 0.778,
                         FM   = 0.903,
                         FP   = 0.872,
                         FS   = 0.833,
                         FSAE = 0.954,
                         FSP  = 0.831,
                         GP   = 0.841,
                         GS   = 0.821,
                         HS   = 0.802,
                         SM   = 0.867,
                         SS   = 0.856,
                         SSM  = 0.876,
                         ST   = 0.818,
                         STS  = 0.820,
                         STR  = 0.842, # STR added from 2010 because 2009-09-19 uses it
                         STU  = 0.836,
                         STX  = 0.822,
                         XP   = 0.882,))

    FACTORS_2010 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.854,
                         ASP  = 0.871,
                         BM   = 0.965,
                         BP   = 0.875,
                         BS   = 0.847,
                         BSP  = 0.865,
                         CM   = 0.915,
                         CP   = 0.866,
                         CS   = 0.840,
                         CSP  = 0.863,
                         DM   = 0.913,
                         DP   = 0.874,
                         DS   = 0.825,
                         DSP  = 0.849,
                         EM   = 0.907,
                         EP   = 0.873,
                         ES   = 0.829,
                         ESP  = 0.852,
                         F125 = 0.959,
                         FJA  = 0.869,
                         FJB  = 0.834,
                         FJC  = 0.772,
                         FM   = 0.908,
                         FP   = 0.876,
                         FS   = 0.837,
                         FSAE = 0.960,
                         FSP  = 0.838,
                         GP   = 0.850,
                         GS   = 0.812,
                         HS   = 0.803,
                         SM   = 0.877,
                         SMF  = 0.870,
                         SS   = 0.860,
                         SSM  = 0.883,
                         ST   = 0.824,
                         STR  = 0.842,
                         STS  = 0.826,
                         STU  = 0.844,
                         STX  = 0.830,
                         XP   = 0.890,))

    FACTORS_2011 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.841,
                         ASP  = 0.862,
                         BM   = 0.958,
                         BP   = 0.870,
                         BS   = 0.839,
                         BSP  = 0.859,
                         CM   = 0.906,
                         CP   = 0.860,
                         CS   = 0.833,
                         CSP  = 0.858,
                         DM   = 0.905,
                         DP   = 0.867,
                         DS   = 0.817,
                         DSP  = 0.844,
                         EM   = 0.910,
                         EP   = 0.863,
                         ES   = 0.825,
                         ESP  = 0.846,
                         F125 = 0.952,
                         FJA  = 0.866,
                         FJB  = 0.826,
                         FJC  = 0.755,
                         FM   = 0.904,
                         FP   = 0.872,
                         FS   = 0.827,
                         FSAE = 0.981,
                         FSP  = 0.835,
                         GP   = 0.837,
                         GS   = 0.809,
                         HS   = 0.791,
                         SM   = 0.869,
                         SMF  = 0.855,
                         SS   = 0.857,
                         SSM  = 0.875,
                         ST   = 0.820,
                         STR  = 0.836,
                         STS  = 0.823,
                         STU  = 0.838,
                         STX  = 0.824,
                         XP   = 0.887,))

    FACTORS_2012 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.844,
                         ASP  = 0.863,
                         BM   = 0.960,
                         BP   = 0.873,
                         BS   = 0.843,
                         BSP  = 0.859,
                         CM   = 0.906,
                         CP   = 0.860,
                         CS   = 0.833,
                         CSP  = 0.857,
                         DM   = 0.915,
                         DP   = 0.868,
                         DS   = 0.821,
                         DSP  = 0.851,
                         EM   = 0.928,
                         EP   = 0.870,
                         ES   = 0.828,
                         ESP  = 0.848,
                         FJB  = 1.0, # FJB Added because archive/2012-03-04.html uses it
                         FJC  = 1.0, # FJC Added because archive/2012-03-04.html uses it
                         FM   = 0.913,
                         FP   = 0.875,
                         FS   = 0.825,
                         FSAE = 0.989,
                         FSP  = 0.838,
                         GP   = 0.850,
                         GS   = 0.814,
                         HS   = 0.799,
                         JA   = 0.876,
                         JB   = 0.834,
                         JC   = 0.747,
                         KM   = 0.952,
                         SM   = 0.866,
                         SMF  = 0.852,
                         SS   = 0.858,
                         SSM  = 0.879,
                         SSP  = 0.865,
                         ST   = 1.0, # ST Added because archive/2012-03-04.html uses it
                         STC  = 0.820,
                         STF  = 0.794,
                         STR  = 0.835,
                         STS  = 0.827,
                         STU  = 0.841,
                         STX  = 0.822,
                         XP   = 0.898,))


    FACTORS_2013 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.847,
                         ASP  = 0.866,
                         BM   = 0.962,
                         BP   = 0.878,
                         BS   = 0.845,
                         BSP  = 0.858,
                         CM   = 0.910,
                         CP   = 0.862,
                         CS   = 0.834,
                         CSP  = 0.861,
                         DM   = 0.918,
                         DP   = 0.874,
                         DS   = 0.826,
                         DSP  = 0.855,
                         EM   = 0.928,
                         EP   = 0.875,
                         ES   = 0.828,
                         ESP  = 0.849,
                         FM   = 0.917,
                         FP   = 0.877,
                         FS   = 0.830,
                         FSAE = 0.989,
                         FSP  = 0.838,
                         GP   = 0.850,
                         GS   = 0.816,
                         HS   = 0.804,
                         JA   = 0.879,
                         JB   = 0.842,
                         JC   = 0.743,
                         KM   = 0.955,
                         RTF  = 0.975, # RTF Added because archive/2013-03-02.html uses it
                         RTR  = 0.951, # RT1 Added because archive/2013-04-28.html uses it
                         RTRCS = 0.813, # Added
                         RTRDS = 0.807, # Added
                         RTRES = 0.807, # Added
                         RTRFS = 0.809, # Added
                         RTRHS = 0.784, # Added
                         SM   = 0.867,
                         SMF  = 0.852,
                         SS   = 0.859,
                         SSM  = 0.881,
                         SSP  = 0.871,
                         STC  = 0.824,
                         STF  = 0.795,
                         STR  = 0.839,
                         STS  = 0.829,
                         STU  = 0.846,
                         STX  = 0.827,
                         XP   = 0.901,))


    FACTORS_2014 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.833,
                         ASP  = 0.866,
                         ASR  = 0.848,
                         BM   = 0.965,
                         BP   = 0.881,
                         BS   = 0.831,
                         BSP  = 0.863,
                         BSR  = 0.845,
                         CM   = 0.922,
                         CP   = 0.864,
                         CS   = 0.821,
                         CSP  = 0.861,
                         CSR  = 0.834,
                         DM   = 0.920,
                         DP   = 0.879,
                         DS   = 0.815,
                         DSP  = 0.855,
                         DSR  = 0.825,
                         EM   = 0.926,
                         EP   = 0.876,
                         ES   = 0.814,
                         ESP  = 0.849,
                         ESR  = 0.828,
                         FM   = 0.924,
                         FP   = 0.883,
                         FS   = 0.818,
                         FSAE = 0.989,
                         FSP  = 0.839,
                         FSR  = 0.830,
                         GP   = 0.850,
                         GS   = 0.806,
                         GSR  = 0.812,
                         HS   = 0.797,
                         HSR  = 0.804,
                         JA   = 0.880,
                         JB   = 0.842,
                         JC   = 0.741,
                         KM   = 0.957,
                         SM   = 0.870,
                         SMF  = 0.851,
                         SS   = 0.843,
                         SSM  = 0.882,
                         SSP  = 0.872,
                         SSR  = 0.860,
                         STC  = 0.824,
                         STF  = 0.801,
                         STR  = 0.838,
                         STS  = 0.829,
                         STU  = 0.846,
                         STX  = 0.827,
                         XP   = 0.906,))


    FACTORS_2015 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.829,
                         ASP  = 0.865,
                         BM   = 0.964,
                         BP   = 0.881,
                         BS   = 0.826,
                         BSP  = 0.863,
                         CAMC = 0.830,
                         CAMS = 0.836,
                         CAMT = 0.825,
                         CM   = 0.919,
                         CP   = 0.864,
                         CS   = 0.814,
                         CSP  = 0.861,
                         DM   = 0.918,
                         DP   = 0.879,
                         DS   = 0.812,
                         DSP  = 0.854,
                         EM   = 0.922,
                         EP   = 0.874,
                         ES   = 0.808,
                         ESP  = 0.849,
                         FM   = 0.926,
                         FP   = 0.880,
                         FS   = 0.810,
                         FSAE = 0.984,
                         FSP  = 0.840,
                         GS   = 0.806,
                         HS   = 0.796,
                         JA   = 0.878,
                         JB   = 0.842,
                         JC   = 0.734,
                         KM   = 0.955,
                         SM   = 0.870,
                         SMF  = 0.853,
                         SS   = 0.835,
                         SSM  = 0.882,
                         SSP  = 0.871,
                         SSR  = 0.859,
                         STF  = 0.801,
                         STR  = 0.838,
                         STS  = 0.828,
                         STU  = 0.844,
                         STX  = 0.831,
                         XP   = 0.905,))


    FACTORS_2016 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.833,
                         ASP  = 0.865,
                         BM   = 0.966,
                         BP   = 0.883,
                         BS   = 0.826,
                         BSP  = 0.863,
                         CAMC = 0.839,
                         CAMS = 0.848,
                         CAMT = 0.834,
                         CM   = 0.916,
                         CP   = 0.864,
                         CS   = 0.819,
                         CSP  = 0.867,
                         DM   = 0.919,
                         DP   = 0.879,
                         DS   = 0.811,
                         DSP  = 0.855,
                         EM   = 0.920,
                         EP   = 0.871,
                         ES   = 0.807,
                         ESP  = 0.852,
                         FM   = 0.926,
                         FP   = 0.880,
                         FS   = 0.814,
                         FSAE = 0.982,
                         FSP  = 0.840,
                         GS   = 0.806,
                         HCR  = 0.838,
                         HCS  = 0.817,
                         HS   = 0.798,
                         JA   = 0.878,
                         JB   = 0.842,
                         JC   = 0.734,
                         KM   = 0.954,
                         SM   = 0.870,
                         SMF  = 0.861,
                         SS   = 0.835,
                         SSM  = 0.882,
                         SSP  = 0.872,
                         SSR  = 0.860,
                         STF  = 0.809,
                         STP  = 0.837,
                         STR  = 0.841,
                         STS  = 0.832,
                         STU  = 0.845,
                         STX  = 0.836,
                         XP   = 0.907,))

    FACTORS_2017 = MappingProxyType(dict(
                         AM   = 1.000,
                         AS   = 0.819,
                         ASP  = 0.856,
                         BM   = 0.956,
                         BP   = 0.869,
                         BS   = 0.813,
                         BSP  = 0.853,
                         CAMC = 0.823,
                         CAMS = 0.838,
                         CAMT = 0.817,
                         CM   = 0.901,
                         CP   = 0.854,
                         CS   = 0.810,
                         CSP  = 0.860,
                         DM   = 0.906,
                         DP   = 0.865,
                         DS   = 0.801,
                         DSP  = 0.842,
                         EM   = 0.905,
                         EP   = 0.859,
                         ES   = 0.794,
                         ESP  = 0.837,
                         FM   = 0.916,
                         FP   = 0.873,
                         FS   = 0.804,
                         FSAE = 0.966,
                         FSP  = 0.829,
                         GS   = 0.793,
                         HCR  = 0.825,
                         HCS  = 0.809,
                         HS   = 0.786,
                         JA   = 0.864,
                         JB   = 0.834,
                         JC   = 0.726,
                         KM   = 0.939,
                         SM   = 0.861,
                         SMF  = 0.848,
                         SS   = 0.826,
                         SSM  = 0.875,
                         SSP  = 0.862,
                         SSR  = 0.847,
                         STF  = 0.800,
                         STP  = 0.820,
                         STR  = 0.830,
                         STS  = 0.818,
                         STU  = 0.831,
                         STX  = 0.822,
                         XP   = 0.892,))
    # Pax data from
    # http://solotime.info/pax/rtp2018.html
    # (Hyphens removed)
    FACTORS_2018 = MappingProxyType(dict(
                         AM    = 1.000,
                         AS    = 0.814,
                         ASP   = 0.848,
                         BM    = 0.956,
                         BP    = 0.860,
                         BS    = 0.808,
                         BSP   = 0.846,
                         CAMC  = 0.816,
                         CAMS  = 0.831,
                         CAMT  = 0.807,
                         CM    = 0.890,
                         CP    = 0.847,
                         CS    = 0.805,
                         CSP   = 0.857,
                         DM    = 0.895,
                         DP    = 0.858,
                         DS    = 0.794,
                         DSP   = 0.835,
                         EM    = 0.894,
                         EP    = 0.850,
                         ES    = 0.787,
                         ESP   = 0.828,
                         FM    = 0.904,
                         FP    = 0.863,
                         FS    = 0.797,
                         FSAE  = 0.958,
                         FSP   = 0.819,
                         GS    = 0.786,
                         HCR   = 0.812,
                         HCS   = 0.791,
                         HS    = 0.781,
                         JA    = 0.855,
                         JB    = 0.825,
                         JC    = 0.718,
                         KM    = 0.928,
                         SM    = 0.853,
                         SMF   = 0.839,
                         SS    = 0.817,
                         SSC   = 0.806,
                         SSM   = 0.871,
                         SSP   = 0.852,
                         SSR   = 0.838,
                         STH   = 0.811,
                         STP   = 0.815,
                         STR   = 0.823,
                         STS   = 0.810,
                         STU   = 0.824,
                         STX   = 0.813,
                         XP    = 0.884,))

    # Pax data from
    # http://solotime.info/pax/rtp2019.html
    # (Hyphens removed)
    FACTORS_2019 = MappingProxyType(dict(
                        STM   = 0.833, # STM IS CUSTOM TO ARKANSAS

                        AM    = 1.000,
                        AS    = 0.817,
                        ASP   = 0.850,
                        BM    = 0.960,
                        BP    = 0.865,
                        BS    = 0.810,
                        BSP   = 0.851,
                        CAMC = 0.820,
                        CAMS = 0.833,
                        CAMT = 0.812,
                        CM    = 0.891,
                        CP    = 0.848,
                        CS    = 0.809,
                        CSP   = 0.857,
                        DM    = 0.895,
                        DP    = 0.858,
                        DS    = 0.800,
                        DSP   = 0.840,
                        EM    = 0.894,
                        EP    = 0.849,
                        ES    = 0.789,
                        ESP   = 0.836,
                        FM    = 0.907,
                        FP    = 0.863,
                        FS    = 0.803,
                        FSAE  = 0.962,
                        FSP   = 0.824,
                        GS    = 0.788,
                        HCR   = 0.814,
                        HCS   = 0.793,
                        HS    = 0.780,
                        JA    = 0.856,
                        JB    = 0.822,
                        JC    = 0.718,
                        KM    = 0.930,
                        SM    = 0.855,
                        SMF   = 0.841,
                        SS    = 0.821,
                        SSC   = 0.801,
                        SSM   = 0.875,
                        SSP   = 0.853,
                        SSR   = 0.843,
                        STH   = 0.813,
                        STR   = 0.827,
                        STS   = 0.811,
                        STU   = 0.828,
                        STX   = 0.815,
                        XP    = 0.885,))

    # Pax data from
    # http://solotime.info/pax/rtp2020.html
    # (Hyphens removed)
    FACTORS_2020 = MappingProxyType(dict(
                        # New Classes This Year
                        XSA  = 0.844,
                        XSB  = 0.864,
                        EV   = 0.824,

                        AM   = 1.000,
                        AS   = 0.819,
                        ASP  = 0.849,
                        BM   = 0.962,
                        BP   = 0.867,
                        BS   = 0.814,
                        BSP  = 0.852,
                        CAMC = 0.818,
                        CAMS = 0.833,
                        CAMT = 0.817,
                        CM   = 0.893,
                        CP   = 0.851,
                        CS   = 0.809,
                        CSP  = 0.865,
                        DM   = 0.895,
                        DP   = 0.866,
                        DS   = 0.806,
                        DSP  = 0.842,
                        EM   = 0.896,
                        EP   = 0.850,
                        ES   = 0.793,
                        ESP  = 0.839,
                        FM   = 0.911,
                        FP   = 0.868,
                        FS   = 0.804,
                        FSAE = 0.963,
                        FSP  = 0.823,
                        GS   = 0.792,
                        HCR  = 0.815,
                        HCS  = 0.794,
                        HS   = 0.780,
                        JA   = 0.855,
                        JB   = 0.820,
                        JC   = 0.718,
                        KM   = 0.930,
                        SM   = 0.854,
                        SMF  = 0.841,
                        SS   = 0.822,
                        SSC  = 0.798,
                        SSM  = 0.875,
                        SSP  = 0.853,
                        SSR  = 0.843,
                        STH  = 0.813,
                        STR  = 0.827,
                        STS  = 0.812,
                        STU  = 0.828,
                        STX  = 0.816,
                        XP   = 0.880,))




    @classmethod
    def factor(cls, year, car_class):
        if not Shared.NOT_JUST_WHITESPACE_REGEX.search(car_class):
            print('WARNING: generating PAX of 1.0 because car class empty')
            return Decimal('1.0')

        factors = getattr(cls, f'FACTORS_{year}')

        car_class = car_class.upper().strip()

        # Remove Ladies designation
        if car_class.endswith('L'):
            car_class = car_class[0:-1]

        # Remove Novice Designation
        if car_class.startswith('N'):
            car_class = car_class[1:]

        factor = factors[car_class]
        return Decimal(str(factor))

